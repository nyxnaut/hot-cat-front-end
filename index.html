<!doctype html>
<!--
Copyright 2017 Wil.ly Hellcat
Mit Licensed, details viewable at https://github.com/nyxnaut/ot-crdt-view
-->
<html>
<head>
	<meta charset="utf-8">
	<title>Hot-Cat Editor</title>
	<meta name="description" content="A web based code editor">
	<link rel="import" href="../bower_components/d2l-menu/d2l-menu.html">
	<link rel="import" href="../bower_components/d2l-menu/d2l-menu-item.html">
	<script src="bower_components/webcomponentsjs/webcomponents-loader.js"></script>
	<style>
		body {
			display: block;
			padding: 0.7rem, 1.5rem;
			font-family: 'Roboto', 'Noto', sans-serif;
			line-height: 1.5;
			min-height: 100vh;
			background-color: #eeeeee;
		}
	</style>
</head>
<body>
	<h1>Hot-Cat Editor</h1>
	<d2l-menu id="menu" label="filesystem"></d2l-menu>
	<textarea id="text" cols="80" rows="24" autofocus></textarea>
	<noscript>
		It is literally impossible to use any of this app without JavaScript.
		Please enable JS and reload to use this site.
	</noscript>
</body>
<script>
	const menuRoot = document.getElementById("menu");
	const method   = "GET";
	const url      = "/api/v0/directory";
	const xhr      = new XMLHttpRequest();
	xhr.open(method, url, true);
	xhr.onreadystatechange = () => {
		if(xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
			addDir(JSON.parse(xhr.responseText), menuRoot);
		}
	}
	xhr.send();
	const addDir = (obj, root) => {
		console.log(obj)
		Object.keys(obj).forEach(key => {
			if (key === 'directories') {
				Object.keys(obj[key]).forEach(el => {
					const file = document.createElement("d2l-menu-item");
					const dir = document.createElement("d2l-menu");
					file.setAttribute('text', el);
					root.appendChild(file);
					file.appendChild(dir);
					addDir(obj[key][el], dir);
				});
			} else if (key === 'files') {
				obj[key].forEach(el => {
					const file = document.createElement("d2l-menu-item");
					file.setAttribute('text', el);
					root.appendChild(file);
				});
			} else {
				console.log("Error in object key: " + key);
			}
		});
	}
</script>
</html>
